<template>
  <div class="__chat">
    <!-- Quick Nav: BEGIN -->
    <ul class="m-nav-sticky" style="margin-top: 30px;">
      <li class="m-nav-sticky__item" data-toggle="m-tooltip" title="Purchase" data-placement="left">
        <a href="https://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes" target="_blank">
          <i class="la la-cart-arrow-down"></i>
        </a>
      </li>
      <li class="m-nav-sticky__item" data-toggle="m-tooltip" title="Documentation" data-placement="left">
        <a href="https://keenthemes.com/metronic/documentation.html" target="_blank"><i class="la la-code-fork"></i></a>
      </li>
      <li class="m-nav-sticky__item" data-toggle="m-tooltip" title="Chat" data-placement="left">
        <a href="#" id="addClass">
          <i class="la la-comments"></i>
        </a>
      </li>
    </ul>
    <!-- Quick Nav: END -->
    <!-- Chat box: BEGIN -->
    <div id="shopee-chat-embedded" style="z-index: 1000; position: fixed; right: 10px; bottom: 0;"
        class="shopee-chat-root ember-application">
      <div id="ember306" class="ember-view">
        <div class="shopee-chat-container" id="_shopee-chat-container">
          <div class="buddy-list">
            <div class="chat-header first">
              <div class="chat-input header-search">
                <input type="text" placeholder="Tìm người dùng" class="ember-text-field ember-view">
                <span class="chat-input-prefix">
                  <span class="ic webchat_search"></span>
                </span>
              </div>
            </div>

            <div class="list show-offer">
              <div class="ember-view">
                <div id="ember814" class="ember-view"
                    style="overflow: auto; transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1); position: absolute; left: 0px; top: 0px; bottom: 0px; right: 0px;">
                  <div style="position: relative; width: 155px; height: 100px;">
                    <div
                        style="position:absolute;top:0;left:0;transform:matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);width:138px;height:50px;">
                      <div id="ember816" class="ember-view">
                        <a href="/chat/136117046" id="ember817" class="buddy-item active ember-view">
                          <div class="shopee-chat__avatar">
                            <img
                                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAMAAAAKE/YAAAABJlBMVEXP2NxgfYtjf412j5uMoavO19uis7vG0dVxi5fBzNJyjJhjgI56kp5hfoxxi5h5kZ2ouL9ohJGInaipucCHnah3kJyxv8bL1NnM1dlphJGXqrN4kZzM1tqUp7Gnt76InqlkgY6wvsWGnKdrhpOnuL+xwMZ8lJ+3xMvAzNGCmaTFz9Sdr7fN1trN19tlgY5qhZJkgI6/y9COoqzL1dlphJJ0jZp7k566x8y7x81ng5CywMegsrp4kZ14kJyhs7uJn6nH0dZlgY+Fm6bG0daWqrO2xMqzwcfF0NXBzdK3xcu0wsh7k5+qusG0wsmzwchuiJVviZaYq7S7yM2Kn6m8yM6/y9GInqiWqbKNoqxzjJmjtLyqucGfsbmdr7iwv8WKoKpuiZVif42PQ9RwAAABzUlEQVR4Xu3YVZLjShBA0UyBmZmamXuYmZmZ3tv/Jua3Y8JWTdsKKR1zzwruR1aVlDIdAAAAAAAAAAAAAAAAAADyN1t+3fPqfiOTl7kQ1qp6QqkZinmdnP6hcFVs6wY6RtATwx75OlY7K2ZlczpBzmx194ZONOyKTbc0QiAmrWikFTHoIKeRKgdiz7o6LIo919XhophzRp3yYs01dcqINavqtCTWXFAnX6y5ok7nxZqyOhWJNjAeHERzVx6Py7Y6PRZzqnP4wSQ1dajN4U9AIRSDOhqpIyYFGuGs2HRuqBMNR/O3rKlYXjG1dazhbTGsF4yd557YtlFwrHpNCpslPeHZ81DmQj7T8OvFYt9vfM3LPwkAgOzDzMLdUqV/qHqnXymtLmRe3hPD9h/s7RzpGEc7e1v7Yk+4dX/zWCMsbw6eiClPgzV107XPL8SI3cEr/Wuv3+xK+t4ueXoq3rv3kq4PrbKeWvnjtqRn9MnTqXiDkaTkUkGn9uWypKK5rDM4/CYp+K4z+iGJW9SZrSc+z57OzEt6rtsag6ok6qfGYkOS1NJY/JIk/aexyEmS/tdYHEuSNCbzGU000UQTTTQAAAAAAAAAAAAAAAAAAL8BwZgl987F+p8AAAAASUVORK5CYII="
                                width="100%" height="100%">
                            <div
                                style="position: absolute; right: -15%; top: -15%; font-size: 10px; height: 15px; min-width: 15px; line-height: 15px;"
                                class="badge ">
                            </div>
                          </div>
                          <div class="shopee-chat__name">
                            luckyshop06
                          </div>
                          <div class="shopee-chat__close">
                            ✕
                          </div>
                        </a>
                      </div>
                    </div>
                    <div
                        style="position:absolute;top:0;left:0;transform:matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 50, 0, 1);width:138px;height:50px;">
                      <div id="ember820" class="ember-view">
                        <a href="/chat/77371462" id="ember821" class="buddy-item ember-view">
                          <div class="shopee-chat__avatar">
                            <img src="//cf.shopee.vn/file/e0c25c8c616bcbd1dcbaa5caffa58dac_tn" width="100%"
                                height="100%">
                            <div
                                style="position: absolute; right: -15%; top: -15%; font-size: 10px; height: 15px; min-width: 15px; line-height: 15px;"
                                class="badge ">
                            </div>
                          </div>
                          <div class="shopee-chat__name">
                            3cworld.vn
                          </div>
                          <div class="shopee-chat__close">
                            ✕
                          </div>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <a href="/offer" id="ember823" class="link-offer ember-view">
              Đã nhận trả giá
              <span class="badge">0</span>
            </a>
          </div>

          <div class="conversation-window">
            <div class="chat-header">
              <a style="cursor: pointer;" class="shopee-chat-close-button" id="chat-close-button">
                <span></span>
              </a>
              <div class="user-menu ember-view">
                <span style="cursor:pointer;" class="shopee-chat-header-text">
                  luckyshop06
                  <span class="arrow-down "></span>
                </span>
              </div>
            </div>

            <div class="chat-window ember-view">
              <div class="chat-content shopee-chat__scrollable chat-content ember-view">
                <div class="shopee-chat__scrollable-inner">

                  <div class="chat-message ember-view">
                    <div class="shopee-chat-grid">
                      <div class="col-15 message-content ">
                        <div class="chat-bubble to">
                          <div class="overflow-wrapper">
                            Shop ơi có bán ví nhiều ngăn kèm cùng sp này ko ạ, em muốn lấy ví nhiều ngăn thay vì ví nhỏ kia, bù thêm tiền cũng dc ạ
                          </div>
                        </div>
                        <div class="timestamp">
                          20-08-2018 14:49
                        </div>
                      </div>
                      <div class="col-1">
                        <div class="avatar">
                          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAMAAAAKE/YAAAABJlBMVEXP2NxgfYtjf412j5uMoavO19uis7vG0dVxi5fBzNJyjJhjgI56kp5hfoxxi5h5kZ2ouL9ohJGInaipucCHnah3kJyxv8bL1NnM1dlphJGXqrN4kZzM1tqUp7Gnt76InqlkgY6wvsWGnKdrhpOnuL+xwMZ8lJ+3xMvAzNGCmaTFz9Sdr7fN1trN19tlgY5qhZJkgI6/y9COoqzL1dlphJJ0jZp7k566x8y7x81ng5CywMegsrp4kZ14kJyhs7uJn6nH0dZlgY+Fm6bG0daWqrO2xMqzwcfF0NXBzdK3xcu0wsh7k5+qusG0wsmzwchuiJVviZaYq7S7yM2Kn6m8yM6/y9GInqiWqbKNoqxzjJmjtLyqucGfsbmdr7iwv8WKoKpuiZVif42PQ9RwAAABzUlEQVR4Xu3YVZLjShBA0UyBmZmamXuYmZmZ3tv/Jua3Y8JWTdsKKR1zzwruR1aVlDIdAAAAAAAAAAAAAAAAAADyN1t+3fPqfiOTl7kQ1qp6QqkZinmdnP6hcFVs6wY6RtATwx75OlY7K2ZlczpBzmx194ZONOyKTbc0QiAmrWikFTHoIKeRKgdiz7o6LIo919XhophzRp3yYs01dcqINavqtCTWXFAnX6y5ok7nxZqyOhWJNjAeHERzVx6Py7Y6PRZzqnP4wSQ1dajN4U9AIRSDOhqpIyYFGuGs2HRuqBMNR/O3rKlYXjG1dazhbTGsF4yd557YtlFwrHpNCpslPeHZ81DmQj7T8OvFYt9vfM3LPwkAgOzDzMLdUqV/qHqnXymtLmRe3hPD9h/s7RzpGEc7e1v7Yk+4dX/zWCMsbw6eiClPgzV107XPL8SI3cEr/Wuv3+xK+t4ueXoq3rv3kq4PrbKeWvnjtqRn9MnTqXiDkaTkUkGn9uWypKK5rDM4/CYp+K4z+iGJW9SZrSc+z57OzEt6rtsag6ok6qfGYkOS1NJY/JIk/aexyEmS/tdYHEuSNCbzGU000UQTTTQAAAAAAAAAAAAAAAAAAL8BwZgl987F+p8AAAAASUVORK5CYII=">
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="chat-message ember-view">
                    <div class="shopee-chat-grid">
                      <div class="col-1">
                        <div class="avatar">
                          <img src="//cf.shopee.vn/file/01a22c4233b32279bbcc2c324dbd5c24_tn" height="37">
                        </div>
                      </div>
                      <div class="col-15 message-content reverse">
                        <div class="chat-bubble from">
                          <div class="overflow-wrapper">
                            Xin chào, tôi có thể giúp gì cho ban
                            - Miễn Phí Vận Chuyển với đơn hàng trên ₫99.000 giao tại TP.HCM, Hà Nội,trên ₫200.000 giao tại các tỉnh / thành khác (giảm tối đa 40.000 VNĐ
                            nhập mã [ Nhập Mã GHNWED giảm 15% ]
                          </div>
                        </div>
                        <div class="timestamp">
                          20-08-2018 14:49
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="chat-message ember-view">
                    <div class="shopee-chat-grid">
                      <div class="col-1">
                        <div class="avatar">
                          <img src="//cf.shopee.vn/file/01a22c4233b32279bbcc2c324dbd5c24_tn" height="37">
                        </div>
                      </div>
                      <div class="col-15 message-content reverse">
                        <div class="chat-bubble from">
                          <div class="overflow-wrapper">
                            Vậy b đặt thêm ví nhé
                          </div>
                        </div>
                        <div class="timestamp">
                          20-08-2018 16:00
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="chat-panel">
                <textarea placeholder="Gửi tin nhắn ..." maxlength="5000" class="ember-text-area ember-view"></textarea>
                <div class="chat-toolbar">
                  <div class="clearfix">
                    <div class="right">
                      <button v-on:click="sendMessage" class="shopee-chat__primary">
                        Gửi
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <input type="file" multiple="" accept=".png,.jpg,.jpeg,.gif" style="display:none;">
            </div>

          </div>
        </div>
        <div class="liquid-modal liquid-modal--closed">
          <div class="liquid-child">
            <div class="lm-container">
              <div role="dialog" class="lf-dialog"></div>
            </div>
            <span class="lf-overlay"></span>
          </div>
        </div>
      </div>
    </div>
    <!-- Chat box: END -->
  </div>
</template>

<script>
  import http from '../../services/http-common';
  import toastr from '../../services/toastr.js';

  export default {
    name: "Chat",
    data() {
      return {
        stompClient: null,
        headers: {},
        params: {
          idSend: 1,
          idReceive: 2
        }
      }
    },
    methods: {
      initChat: function () {
        let vm = this;
        let authorization = localStorage.getItem("authorization");
        let socket = new WebSocket('ws://localhost:8080/carpool/websocket?authorization=' + authorization);
        vm.stompClient = Stomp.over(socket);
        vm.stompClient.debug = false;
        let headers = {};
        headers["authorization"] = authorization;
        vm.stompClient.connect({headers}, function(frame) {
          vm.stompClient.subscribe('/socket/message/' + '3', function(message){
            alert(message);
          });
        });
      },
      getConversation: function() {
        let queryString = Object.keys(this.params).map(key => key + '=' + this.params[key]).join('&');
        console.log(queryString);
        http.get('/message' + '?' + queryString)
            .then(response => {
              console.log(response.data.metadata);
            })
            .catch(e => {
              console.error(e);
              toastr.error("Error occurred");
            });
      },
      sendMessage: function () {
        let authorization = localStorage.getItem("authorization");
        let headers = {};
        headers["authorization"] = authorization;
        let url = '/user/3/';
        this.stompClient.send(
            url,
            {headers},
            JSON.stringify({'id': 123, 'userIdSend': 1, 'userIdReceive': 2, 'content': 'aaaaaa'})
        );
      }
    },
    mounted() {
      this.initChat();
      this.getConversation();
    }
  }
</script>

<style scoped>
  .col-1 {
     padding-right: 0;
     padding-left: 0;
  }
</style>
